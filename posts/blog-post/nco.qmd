---
title: "NetCDF Operators (NCO)"
description: ""
author: "Sunny Hospital"
date: "06/25/2025"
categories: ["metadata"]
image: "cat.jpeg"
draft: false
html:
    format:
        code-block-bg: true
        code-block-border-left: "#31BAE9"
---

```mermaid
flowchart TD

    %% =========================
    %% NOAA OCIO DNS
    %% =========================
    subgraph OCIO["NOAA OCIO (External DNS)"]
        dns["DNS Record\n(erddap.some.noaa.gov)"]
    end

    %% =========================
    %% GCP PROJECT
    %% =========================
    subgraph GCP["GCP Project (e.g. ggn-nmfs-swfscerddap-dev-1)"]

        %% ---- Networking ----
        subgraph NET["VPC Network: erddap-vpc"]
            subnet["Subnetwork: erddap-subnet"]

            %% Data Processing VM
            dpvm["Compute Engine VM\nvm-data-proc\nSA: sa-data-proc"]

            %% ERDDAP VM
            erddapvm["Compute Engine VM\nvm-erddap\nSA: sa-erddap"]

            %% Firewall Rules
            fw_internal["Firewall: allow-internal\n(VPC internal traffic)"]
            fw_lb["Firewall: allow-lb-to-erddap\n(source: LB ranges → ERDDAP port)"]
            fw_hc["Firewall: allow-health-checks\n(source: HC ranges)"]
        end

        %% ---- Storage (GCS Buckets) ----
        subgraph GCS["Cloud Storage"]
            braw["Bucket: bucket-raw-data"]
            bproc["Bucket: bucket-processed-data"]
            bpub["Bucket: bucket-erddap-published"]
        end

        %% ---- IAM ----
        subgraph IAM["IAM Bindings"]
            iam_dp_raw["sa-data-proc → bucket-raw-data\nroles/storage.objectAdmin"]
            iam_dp_proc["sa-data-proc → bucket-processed-data\nroles/storage.objectAdmin"]
            iam_erddap_pub["sa-erddap → bucket-erddap-published\nroles/storage.objectViewer or objectAdmin"]
        end

        %% ---- External HTTPS Load Balancer ----
        subgraph LB["External HTTPS Load Balancer"]
            ip["Global Address\n(erddap-lb-ip)"]
            hc["HealthCheck: erddap-hc\nHTTP(S) /erddap/index.html"]
            ig["InstanceGroup or NEG\n(backends: vm-erddap)"]
            be["BackendService: erddap-backend\n(protocol HTTP)"]
            um["UrlMap: erddap-url-map\n(routes /, /erddap/*)"]
            cert["(Managed)SslCertificate: erddap-ssl-cert"]
            proxy["TargetHttpsProxy: erddap-https-proxy"]
            fr["GlobalForwardingRule: erddap-https-fr\n:443 → proxy"]
        end
    end

    %% =========================
    %% Connections
    %% =========================

    %% DNS → LB IP
    dns -->|"A/CNAME → erddap-lb-ip"| ip

    %% Forwarding rule → proxy → URL map → backend service
    ip --> fr --> proxy --> cert
    proxy --> um --> be

    %% backend service → instance group/NEG → ERDDAP VM
    be -->|"backends"| ig -->|"targets"| erddapvm

    %% Health check → ERDDAP VM
    hc --> erddapvm

    %% VMs → Subnet
    subnet --> dpvm
    subnet --> erddapvm

    %% Data flows: data processing VM ↔ buckets
    dpvm -->|"read/write"| braw
    dpvm -->|"read/write"| bproc
    dpvm -->|"write"| bpub

    %% ERDDAP VM → published bucket
    erddapvm -->|"read (gcsfuse / API)"| bpub

    %% IAM relationships (dashed to show logical binding)
    iam_dp_raw -.-> braw
    iam_dp_raw -.-> dpvm
    iam_dp_proc -.-> bproc
    iam_dp_proc -.-> dpvm

    iam_erddap_pub -.-> bpub
    iam_erddap_pub -.-> erddapvm

    %% Firewall relations (conceptual)
    fw_internal -.-> dpvm
    fw_internal -.-> erddapvm

    fw_lb -.-> erddapvm
    fw_hc -.-> erddapvm


## Useful nco commands

For full descriptions, check out the resource links.

### `nccopy` 

The nccopy compresses a netCDF file at various levels

**usage:**  ```nccopy [-flag] [original nc filename]  [compressed nc filename]
```

**example**
``` nccopy -d4 largeFile.nc compressedFile.nc```

**options**: 

`-d` flag represents deflation level from 1 to 9 and is required.

Level 1 (faster compression) to Level 9 (smaller compression)


### `ncdump`


The ncdump generates an ASCII representation (common data language) of a netCDF file.

**usage**: ```ncdump [-flag] [your nc filename] > [your output file]
```

**example:** ```ncdump -c input.nc > output.cdl```

**options:**  ```ncdump -h``` 
outputs the header info; same as -c but doesn’t include values


### `ncgen`

The command reads the .cdl file and generates a NetCDF

**usage:**  ```ncgen -o nc_file cdl_file```

**example:**  

```
ncgen -o output.nc input.cdl # specify an output file
   
ncgen -b input.cdl # caution, this overwites nc if it exists

ncgen -k4 -o output.nc imput.cdl # Output netCDF-4 classic model file

```



### `ncks`

This command merges (appends with -A) the new attributes from metadata.nc file into your existing NetCDF file.

**usage:** ```nck -A filename1.nc filename2.nc```

**example:** ```ncks -A metadata.nc mydata_file.nc```

## Resources

https://www.bic.mni.mcgill.ca/users/sean/Docs/netcdf/guide.txn_79.html

https://www.unidata.ucar.edu/software/netcdf/workshops/2011/utilities/NcgenExamples.html
